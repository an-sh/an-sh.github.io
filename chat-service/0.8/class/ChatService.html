<!DOCTYPE html>
<html>
  <head>
  <meta charset='UTF-8'>
  <title>Chat service Documentation</title>
  <script src='../javascript/application.js'></script>
  <script src='../javascript/search.js'></script>
  <link rel='stylesheet' href='../stylesheets/application.css' type='text/css'>
</head>
  <body>
    <div id='base' data-path='../'></div>
<div id='header'>
  <div id='menu'>
    <a href='../extra/README.md.html' title='Chat service'>
      Chat service
    </a>
    &raquo;
    <a href='../alphabetical_index.html' title='Index'>
      Index
    </a>
    &raquo;
    <span class='title'>ChatService</span>
  </div>
</div>
    <div id='content'>
      <h1>
        Class:
        ChatService
      </h1>
      <table class='box'>
        <tr>
          <td>Defined in:</td>
          <td>src&#47;ChatService.coffee</td>
        </tr>
        <tr>
          <td>Inherits:</td>
          <td>
            <a href='../class/ChatServiceEvents.html'>ChatServiceEvents</a>
          </td>
        </tr>
        <tr>
          <td>Extends:</td>
          <td>
            <a href='../mixin/ServiceAPI.html'>ServiceAPI</a>
            <a href='../mixin/RecoveryAPI.html'>RecoveryAPI</a>
          </td>
        </tr>
      </table>
      <h2>Overview</h2>
      <div class='docstring'>
  <p>Service class, is the package exported object.</p>
</div>
<div class='tags'>
</div>
      <h2>Property Summary</h2>
      <dl class='properties'>
        <dt id='validator-property'>
          <span class='signature'>
            (Object)
            <b>
              validator
            </b>
          </span>
        </dt>
        <dd class='desc'>
          <a href='../class/ArgumentsValidator.html'>ArgumentsValidator</a> instance. 
        </dd>
        <dt id='transport-property'>
          <span class='signature'>
            (Object)
            <b>
              transport
            </b>
          </span>
        </dt>
        <dd class='desc'>
          <a href='../class/Transport.html'>Transport</a> instance. 
        </dd>
        <dt id='io-property'>
          <span class='signature'>
            (Object or null)
            <b>
              io
            </b>
          </span>
        </dt>
        <dd class='desc'>
          Socket.io server. 
        </dd>
        <dt id='nsp-property'>
          <span class='signature'>
            (Object or null)
            <b>
              nsp
            </b>
          </span>
        </dt>
        <dd class='desc'>
          Socket.io server namespace. 
        </dd>
        <dt id='redis-property'>
          <span class='signature'>
            (Object or null)
            <b>
              redis
            </b>
          </span>
        </dt>
        <dd class='desc'>
          State ioredis instance. 
        </dd>
        <dt id='clusterBus-property'>
          <span class='signature'>
            (EventEmitter)
            <b>
              clusterBus
            </b>
          </span>
        </dt>
        <dd class='desc'>
          Cluster communication via adapter. Emits messages to all services nodes, including the sender node. 
        </dd>
        <dt id='instanceUID-property'>
          <span class='signature'>
            (String)
            <b>
              instanceUID
            </b>
          </span>
        </dt>
        <dd class='desc'>
          Service instance UID. 
        </dd>
        <dt id='ChatServiceError-property'>
          <span class='signature'>
            (Constructor)
            <b>
              ChatServiceError
            </b>
          </span>
        </dt>
        <dd class='desc'>
          <a href='../class/ChatServiceError.html'>ChatServiceError</a> class constructor. 
        </dd>
      </dl>
      <h2>Instance Method Summary</h2>
      <ul class='summary'>
  <li>
    <span class='signature'>
      <a href='#close-dynamic'>
        #
(Promise)
<b>close</b><span>(done)</span>
      </a>
    </span>
    <span class='desc'>
      Closes server. 
    </span>
  </li>
</ul>
      <h2>
        <small>Extended Method Summary</small>
      </h2>
      <h3 class='inherited'>
        Methods extended from
        <a href='../mixin/ServiceAPI.html'>ServiceAPI</a>
      </h3>
      <p class='inherited'>
        <a href='../mixin/ServiceAPI.html#execUserCommand-static'>.execUserCommand</a>
        <a href='../mixin/ServiceAPI.html#addUser-static'>.addUser</a>
        <a href='../mixin/ServiceAPI.html#deleteUser-static'>.deleteUser</a>
        <a href='../mixin/ServiceAPI.html#hasUser-static'>.hasUser</a>
        <a href='../mixin/ServiceAPI.html#userHasInList-static'>.userHasInList</a>
        <a href='../mixin/ServiceAPI.html#hasDirectAccess-static'>.hasDirectAccess</a>
        <a href='../mixin/ServiceAPI.html#disconnectUserSockets-static'>.disconnectUserSockets</a>
        <a href='../mixin/ServiceAPI.html#addRoom-static'>.addRoom</a>
        <a href='../mixin/ServiceAPI.html#deleteRoom-static'>.deleteRoom</a>
        <a href='../mixin/ServiceAPI.html#hasRoom-static'>.hasRoom</a>
        <a href='../mixin/ServiceAPI.html#roomHasInList-static'>.roomHasInList</a>
        <a href='../mixin/ServiceAPI.html#hasRoomAccess-static'>.hasRoomAccess</a>
        <a href='../mixin/ServiceAPI.html#changeRoomOwner-static'>.changeRoomOwner</a>
        <a href='../mixin/ServiceAPI.html#changeRoomHistoryMaxSize-static'>.changeRoomHistoryMaxSize</a>
      </p>
      <h3 class='inherited'>
        Methods extended from
        <a href='../mixin/RecoveryAPI.html'>RecoveryAPI</a>
      </h3>
      <p class='inherited'>
        <a href='../mixin/RecoveryAPI.html#userStateSync-static'>.userStateSync</a>
        <a href='../mixin/RecoveryAPI.html#roomStateSync-static'>.roomStateSync</a>
        <a href='../mixin/RecoveryAPI.html#instanceRecovery-static'>.instanceRecovery</a>
        <a href='../mixin/RecoveryAPI.html#getInstanceHeartbeat-static'>.getInstanceHeartbeat</a>
      </p>
      <h2>Constructor Details</h2>
      <div class='methods'>
  <div class='method_details'>
    <p class='signature' id='constructor-dynamic'>
      #
(void)
<b>constructor</b><span>(options = {}, hooks = {})</span>
      <br>
    </p>
    <div class='docstring'>
  <div class='note'>
    <strong>Note:</strong>
    <code>&#39;redis&#39;</code> state and <code>&#39;redis&#39;</code> adapter and theirs options are NOT related, two separate clients are used with two different configurations, which can be set to use the same Redis server. 
  </div>
  <p>Crates an object and starts a new service instance.</p>
</div>
<div class='tags'>
  <h3>Parameters:</h3>
  <ul class='param'>
    <li>
      <span class='name'>options</span>
      <span class='type'>
        (
          <tt>Object</tt>
        )
      </span>
      &mdash;
      <span class='desc'>Service configuration options. </span>
    </li>
    <li>
      <span class='name'>hooks</span>
      <span class='type'>
        (
          <tt><a href='../mixin/HooksInterface.html'>HooksInterface</a></tt>
        )
      </span>
      &mdash;
      <span class='desc'>Service customisation hooks. See <a href='../mixin/HooksInterface.html'>HooksInterface</a>. </span>
    </li>
  </ul>
  <h3>
    Options Hash:
    (options):
  </h3>
  <ul class='options'>
    <li>
      <span class='name'>port</span>
      <span class='type'>
        (
          <tt>Number</tt>
        )
      </span>
      &mdash;
      <span class='desc'>Server port, default is <code>8000</code>. </span>
    </li>
    <li>
      <span class='name'>enableAccessListsUpdates</span>
      <span class='type'>
        (
          <tt>Boolean</tt>
        )
      </span>
      &mdash;
      <span class='desc'>Enables <a href='../class/ServerMessages.html#roomModeChanged-dynamic'>ServerMessages#roomModeChanged</a>, <a href='../class/ServerMessages.html#roomAccessListAdded-dynamic'>ServerMessages#roomAccessListAdded</a> and <a href='../class/ServerMessages.html#roomAccessListRemoved-dynamic'>ServerMessages#roomAccessListRemoved</a> messages, default is <code>false</code>. </span>
    </li>
    <li>
      <span class='name'>enableDirectMessages</span>
      <span class='type'>
        (
          <tt>Boolean</tt>
        )
      </span>
      &mdash;
      <span class='desc'>Enables user to user <a href='../class/UserCommands.html#directMessage-dynamic'>UserCommands#directMessage</a> communication, default is <code>false</code>. </span>
    </li>
    <li>
      <span class='name'>enableRoomsManagement</span>
      <span class='type'>
        (
          <tt>Boolean</tt>
        )
      </span>
      &mdash;
      <span class='desc'>Allows to use <a href='../class/UserCommands.html#roomCreate-dynamic'>UserCommands#roomCreate</a> and <a href='../class/UserCommands.html#roomDelete-dynamic'>UserCommands#roomDelete</a>, dafault is <code>false</code>. </span>
    </li>
    <li>
      <span class='name'>enableUserlistUpdates</span>
      <span class='type'>
        (
          <tt>Boolean</tt>
        )
      </span>
      &mdash;
      <span class='desc'>Enables <a href='../class/ServerMessages.html#roomUserJoined-dynamic'>ServerMessages#roomUserJoined</a> and <a href='../class/ServerMessages.html#roomUserLeft-dynamic'>ServerMessages#roomUserLeft</a> messages, default is <code>false</code>. </span>
    </li>
    <li>
      <span class='name'>historyMaxGetMessages</span>
      <span class='type'>
        (
          <tt>Number</tt>
        )
      </span>
      &mdash;
      <span class='desc'>Room history size available via <a href='../class/UserCommands.html#roomRecentHistory-dynamic'>UserCommands#roomRecentHistory</a> or via a single invocation <a href='../class/UserCommands.html#roomHistoryGet-dynamic'>UserCommands#roomHistoryGet</a>, default is <code>100</code>. </span>
    </li>
    <li>
      <span class='name'>defaultHistoryLimit</span>
      <span class='type'>
        (
          <tt>Number</tt>
        )
      </span>
      &mdash;
      <span class='desc'>Is used for <a href='../class/UserCommands.html#roomCreate-dynamic'>UserCommands#roomCreate</a> or when <a href='../mixin/ServiceAPI.html#addRoom-'>ServiceAPI~addRoom</a> is called without <code>historyMaxSize</code> option, default is <code>10000</code>. </span>
    </li>
    <li>
      <span class='name'>useRawErrorObjects</span>
      <span class='type'>
        (
          <tt>Boolean</tt>
        )
      </span>
      &mdash;
      <span class='desc'>Send error objects instead of strings, default is <code>false</code>. See <a href='../class/ChatServiceError.html'>ChatServiceError</a>. </span>
    </li>
    <li>
      <span class='name'>closeTimeout</span>
      <span class='type'>
        (
          <tt>Number</tt>
        )
      </span>
      &mdash;
      <span class='desc'>Maximum time in ms to wait before a server disconnects all clients on shutdown, default is <code>15000</code>. </span>
    </li>
    <li>
      <span class='name'>heartbeatRate</span>
      <span class='type'>
        (
          <tt>Number</tt>
        )
      </span>
      &mdash;
      <span class='desc'>Service instance heartbeat rate in ms, default is <code>10000</code>. </span>
    </li>
    <li>
      <span class='name'>heartbeatTimeout</span>
      <span class='type'>
        (
          <tt>Number</tt>
        )
      </span>
      &mdash;
      <span class='desc'>Service instance heartbeat timeout in ms, after this interval instance is considered inactive, default is <code>30000</code>. </span>
    </li>
    <li>
      <span class='name'>busAckTimeout</span>
      <span class='type'>
        (
          <tt>Number</tt>
        )
      </span>
      &mdash;
      <span class='desc'>Cluster bus ack waiting timeout in ms, default is <code>5000</code>. </span>
    </li>
    <li>
      <span class='name'>state</span>
      <span class='type'>
        (
          <tt>String or Constructor</tt>
        )
      </span>
      &mdash;
      <span class='desc'>Chat state. Can be either <code>&#39;memory&#39;</code> or <code>&#39;redis&#39;</code> for built-in states. Default is <code>&#39;memory&#39;</code>. </span>
    </li>
    <li>
      <span class='name'>transport</span>
      <span class='type'>
        (
          <tt>String or Constructor</tt>
        )
      </span>
      &mdash;
      <span class='desc'>Transport. Default is <code>&#39;socket.io&#39;</code>. </span>
    </li>
    <li>
      <span class='name'>adapter</span>
      <span class='type'>
        (
          <tt>String or Constructor</tt>
        )
      </span>
      &mdash;
      <span class='desc'>Socket.io adapter, used only if no <code>io</code> object is passed in <code>transportOptions</code>. Can be either <code>&#39;memory&#39;</code> or <code>&#39;redis</code>&#39; for built-in adapter, or a custom state constructor function that implements the Socket.io adapter API. Default is <code>&#39;memory&#39;</code>. </span>
    </li>
    <li>
      <span class='name'>stateOptions</span>
      <span class='type'>
        (
          <tt>Object</tt>
        )
      </span>
      &mdash;
      <span class='desc'>Options for a redis state. </span>
    </li>
    <li>
      <span class='name'>transportOptions</span>
      <span class='type'>
        (
          <tt>Object</tt>
        )
      </span>
      &mdash;
      <span class='desc'>Options for a socket.io transport. </span>
    </li>
    <li>
      <span class='name'>adapterOptions</span>
      <span class='type'>
        (
          <tt>Object or Array&lt;Object&gt;</tt>
        )
      </span>
      &mdash;
      <span class='desc'>Socket.io adapter constructor arguments, used only when no <code>io</code> object is passed in <code>transportOptions</code>. </span>
    </li>
  </ul>
  <h3>
    Options Hash:
    (transportOptions):
  </h3>
  <ul class='options'>
    <li>
      <span class='name'>namespace</span>
      <span class='type'>
        (
          <tt>String</tt>
        )
      </span>
      &mdash;
      <span class='desc'>Socket.io namespace, default is <code>&#39;/chat-service&#39;</code>. </span>
    </li>
    <li>
      <span class='name'>io</span>
      <span class='type'>
        (
          <tt>Object</tt>
        )
      </span>
      &mdash;
      <span class='desc'>Socket.io instance that should be used by ChatService. </span>
    </li>
    <li>
      <span class='name'>http</span>
      <span class='type'>
        (
          <tt>Object</tt>
        )
      </span>
      &mdash;
      <span class='desc'>Use socket.io http server integration, used only when no <code>io</code> object is passed in <code>transportOptions</code>. </span>
    </li>
    <li>
      <span class='name'>ioOptions</span>
      <span class='type'>
        (
          <tt>Object</tt>
        )
      </span>
      &mdash;
      <span class='desc'>Socket.io additional options, used only when no <code>io</code> object is passed in <code>transportOptions</code>. </span>
    </li>
  </ul>
  <h3>
    Options Hash:
    (stateOptions):
  </h3>
  <ul class='options'>
    <li>
      <span class='name'>useCluster</span>
      <span class='type'>
        (
          <tt>Boolean</tt>
        )
      </span>
      &mdash;
      <span class='desc'>Enable Redis cluster, default is <code>false</code>. </span>
    </li>
    <li>
      <span class='name'>lockTTL</span>
      <span class='type'>
        (
          <tt>Number</tt>
        )
      </span>
      &mdash;
      <span class='desc'>Locks timeout in ms, default is <code>10000</code>. </span>
    </li>
    <li>
      <span class='name'>redisOptions</span>
      <span class='type'>
        (
          <tt>Object or Array&lt;Object&gt;</tt>
        )
      </span>
      &mdash;
      <span class='desc'>ioredis client constructor arguments. If useCluster is set, used as arguments for a Cluster client. </span>
    </li>
  </ul>
</div>
  </div>
</div>
      <h2>Instance Method Details</h2>
      <div class='methods'>
  <div class='method_details'>
    <p class='signature' id='close-dynamic'>
      #
(Promise)
<b>close</b><span>(done)</span>
      <br>
    </p>
    <div class='docstring'>
  <div class='note'>
    <strong>Note:</strong>
    <strong>MUST</strong> be called before node process shutdown to correctly update the state. 
  </div>
  <p>Closes server.</p>
</div>
<div class='tags'>
  <h3>Parameters:</h3>
  <ul class='param'>
    <li>
      <span class='name'>done</span>
      <span class='type'>
        (
          <tt>callback</tt>
        )
      </span>
      &mdash;
      <span class='desc'>Optional callback. </span>
    </li>
  </ul>
  <h3>Returns:</h3>
  <ul class='return'>
    <li>
      <span class='type'></span>
      <tt>Promise</tt>
    </li>
  </ul>
</div>
  </div>
</div>
    </div>
    <div id='footer'>
  By
  <a href='https://github.com/coffeedoc/codo' title='CoffeeScript API documentation generator'>
    Codo
  </a>
  2.1.0
  &#10034;
  Press H to see the keyboard shortcuts
  &#10034;
  <a href='http://twitter.com/netzpirat' target='_parent'>@netzpirat</a>
  &#10034;
  <a href='http://twitter.com/_inossidabile' target='_parent'>@_inossidabile</a>
</div>
<iframe id='search_frame'></iframe>
<div id='fuzzySearch'>
  <input type='text'>
  <ol></ol>
</div>
<div id='help'>
  <p>
    Quickly fuzzy find classes, mixins, methods, file:
  </p>
  <ul>
    <li>
      <span>T</span>
      Open fuzzy finder dialog
    </li>
  </ul>
  <p>
    Control the navigation frame:
  </p>
  <ul>
    <li>
      <span>L</span>
      Toggle list view
    </li>
    <li>
      <span>C</span>
      Show class list
    </li>
    <li>
      <span>I</span>
      Show mixin list
    </li>
    <li>
      <span>F</span>
      Show file list
    </li>
    <li>
      <span>M</span>
      Show method list
    </li>
    <li>
      <span>E</span>
      Show extras list
    </li>
  </ul>
  <p>
    You can focus and blur the search input:
  </p>
  <ul>
    <li>
      <span>S</span>
      Focus search input
    </li>
    <li>
      <span>Esc</span>
      Blur search input
    </li>
  </ul>
</div>
  </body>
</html>